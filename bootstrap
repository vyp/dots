#! /usr/bin/env nix-shell
#! nix-shell -i bash -p bash git stow
# vim: ft=sh

stow-subdirs-in () {
  cd "$1"
  for dir in */; do stow --no-folding "$dir"; done
}

# Make sure to exit this script on any failure.
set -e

# Make sure we start off in the directory where this script is located.
cd $(dirname "$(readlink -f "$0")")

# Get out of detached head state for submodule checkouts.
git submodule foreach 'git checkout master && git reset --hard $sha1'

# Add some remotes to our local nixpkgs clone.
cd nixos/nixpkgs
git remote add channels https://github.com/nixos/nixpkgs-channels
git remote add fork https://vyp@github.com/vyp/nixpkgs
cd -

# Get some more necessary repositories.
git clone https://vyp@github.com/vyp/scripts ../dev/scripts
git clone https://vyp@github.com/vyp/env ../env

# Finally stow now that we have everything we should need.
stow-subdirs-in .
stow-subdirs-in ../env

# Lastly, reset the font cache to setup fonts.
fc-cache -fv

# Local Variables:
# mode: sh-mode
# End:
